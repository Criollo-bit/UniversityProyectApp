// prisma/schema.prisma

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}


//Modelos de Datos

// 1. Teacher (Docente)
model Teacher {
  id        Int       @id @default(autoincrement())
  firstName String
  lastName  String
  email     String    @unique
  // Relación 1:N (Un profesor imparte muchos cursos)
  courses   Course[]  
}

// 2. Program (Carrera)
model Program {
  id              Int               @id @default(autoincrement())
  name            String            @unique
  duration_semesters Int            // Total de semestres/ciclos
  // Relaciones 1:N
  students        Student[]
  specializations Specialization[]
  semesters       Semester[]
  courses         Course[]
}

// 3. Specialization (Especialidad) - Relacionada con Program
model Specialization {
  id         Int      @id @default(autoincrement())
  name       String   @unique
  programId  Int
  program    Program  @relation(fields: [programId], references: [id])
}

// 4. Semester (Ciclo) - Relacionado con Program
model Semester {
  id         Int      @id @default(autoincrement())
  name       String   
  number     Int     
  programId  Int
  program    Program  @relation(fields: [programId], references: [id])
  // Relación 1:N (Un semestre tiene muchos cursos)
  courses    Course[]
  
  @@unique([programId, number]) 
}

// 5. Course (Materia) - Incluye el campo de Créditos
model Course {
  id          Int                 @id @default(autoincrement())
  name        String
  description String?
  credits     Int                 // Campo de CREDITOS
  
  // Claves Foráneas a entidades padre
  teacherId   Int
  teacher     Teacher             @relation(fields: [teacherId], references: [id])
  
  semesterId  Int
  semester    Semester            @relation(fields: [semesterId], references: [id])

  programId   Int
  program     Program             @relation(fields: [programId], references: [id])

  // Relación N:M a Estudiantes (a través de la tabla de inscripción)
  enrollments CourseEnrollment[]
}

// 6. Student (Estudiante)
model Student {
  id         Int                @id @default(autoincrement())
  firstName  String
  lastName   String
  email      String             @unique
  // Clave Foránea a Program
  programId  Int
  program    Program            @relation(fields: [programId], references: [id])
  // Relación N:M a Courses (a través de la tabla de unión)
  enrollments CourseEnrollment[]
}


// 7. CourseEnrollment (Tabla de Unión N:M - MateriaInscripcion)
model CourseEnrollment {
  studentId       Int
  courseId        Int
  
  enrollmentDate  DateTime    @default(now())
  finalGrade      Float?
  status          String      @default("CURRENT") // Ej: "CURRENT", "PASSED", "FAILED"

  student         Student     @relation(fields: [studentId], references: [id])
  course          Course      @relation(fields: [courseId], references: [id])

  // Clave compuesta
  @@id([studentId, courseId]) 
}